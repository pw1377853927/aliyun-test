<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN""http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge;chrome=1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="{{asset('vendor/admin/css/skin_0.css')}}">
    <title>121商城</title>
    <script type="text/javascript">
        SITEURL = 'http://test.121mai.com/shop';
        RESOURCE_SITE_URL = 'http://test.121mai.com/data/resource';
        MICROSHOP_SITE_URL = 'http://test.121mai.com/microshop';
        CIRCLE_SITE_URL = 'http://test.121mai.com/circle';
        ADMIN_TEMPLATES_URL = 'http://test.121mai.com/admin/templates/default';
        LOADING_IMAGE = "http://test.121mai.com/admin/templates/default/images/loading.gif";
    </script>
</head>
<body id="MyPages">
<div id="append_parent"></div>
<div id="ajaxwaitid"></div>

<div class="page">
    <!-- 页面导航 -->
    <div class="fixed-empty"></div>
    <!-- 帮助 -->
    <table class="table tb-type2" id="prompt">
        <tbody>
        <tr>
            <td>
                <ul>
                    <li>点击右侧组件的<strong>“添加”</strong>按钮，增加对应类型版块到页面，其中<strong>“广告条版块”</strong>只能添加一个。</li>
                    <li>鼠标触及左侧页面对应版块，出现操作类链接，可以对该区域块进行<strong>“移动”、“启用/禁用”、“编辑”、“删除”</strong>操作。</li>
                    <li>新增加的版块内容默认为<strong>“禁用”</strong>状态，编辑内容并<strong>“启用”</strong>该块后将在手机端即时显示。</li>
                </ul>
            </td>
        </tr>
        </tbody>
    </table>
    <!-- 列表 -->
    <div class="mb-special-layout">
        <div class="mb-item-box">
            <div id="item_list" class="item-list">
                <div nctype="special_item" class="special-item adv_list usable" data-item-id="2123">
                    <div class="item_type">轮播图</div>
                    <div id="item_edit_content">
                        <div class="index_block adv_list">
                            <div nctype="item_content" class="content" id="sortable_adv_list">
                                <div nctype="item_image" class="item"><img nctype="image"
                                                                           src="http://test.121mai.com/data/upload/shop/common/05152581740573275_240.gif"
                                                                           alt="">
                                </div>
                            </div>
                        </div>

                        <script type="text/javascript">
                            $(function () {
                            })
                        </script>
                    </div>
                    <div class="handle"><a nctype="btn_move_up" href="javascript:;"><i class="icon-arrow-up"></i>上移</a>
                        <a nctype="btn_move_down" href="javascript:;"><i class="icon-arrow-down"></i>下移</a> <a
                                nctype="btn_usable" data-item-id="2123" href="javascript:;"><i
                                    class="icon-off"></i>禁用</a> <a nctype="btn_edit_item" data-item-id="2123"
                                                                   href="javascript:;"><i class="icon-edit"></i>编辑</a>
                        <a nctype="btn_del_item" data-item-id="2123" href="javascript:;"><i
                                    class="icon-trash"></i>删除</a></div>
                    </td>
                </div>
                <div nctype="special_item" class="special-item home3 usable" data-item-id="2122">
                    <div class="item_type">模型版块布局C（五张图）</div>
                    <div id="item_edit_content">
                        <div class="index_block home3">
                            <div class="title">
                                <span></span>
                            </div>
                            <div nctype="item_content" class="content" id="sortable_home3">
                                <div nctype="item_image" class="item"><img nctype="image"
                                                                           src="http://test.121mai.com/data/upload/shop/common/05152581740573275_240.gif"
                                                                           alt="">
                                </div>
                                <div nctype="item_image" class="item"><img nctype="image"
                                                                           src="http://test.121mai.com/data/upload/shop/common/05152581740573275_240.gif"
                                                                           alt="">
                                </div>
                                <div nctype="item_image" class="item"><img nctype="image"
                                                                           src="http://test.121mai.com/data/upload/shop/common/05152581740573275_240.gif"
                                                                           alt="">
                                </div>
                                <div nctype="item_image" class="item"><img nctype="image"
                                                                           src="http://test.121mai.com/data/upload/shop/common/05152581740573275_240.gif"
                                                                           alt="">
                                </div>
                                <div nctype="item_image" class="item"><img nctype="image"
                                                                           src="http://test.121mai.com/data/upload/shop/common/05152581740573275_240.gif"
                                                                           alt="">
                                </div>
                            </div>
                        </div>

                        <script type="text/javascript">
                            $(function () {
                            })
                        </script>
                    </div>
                    <div class="handle"><a nctype="btn_move_up" href="javascript:;"><i class="icon-arrow-up"></i>上移</a>
                        <a nctype="btn_move_down" href="javascript:;"><i class="icon-arrow-down"></i>下移</a> <a
                                nctype="btn_usable" data-item-id="2122" href="javascript:;"><i
                                    class="icon-off"></i>禁用</a> <a nctype="btn_edit_item" data-item-id="2122"
                                                                   href="javascript:;"><i class="icon-edit"></i>编辑</a>
                        <a nctype="btn_del_item" data-item-id="2122" href="javascript:;"><i
                                    class="icon-trash"></i>删除</a></div>
                    </td>
                </div>
                <div nctype="special_item" class="special-item home2 usable" data-item-id="2121">
                    <div class="item_type">模型版块布局B</div>
                    <div id="item_edit_content">
                        <div class="index_block home2">
                            <div class="title">
                                <span></span>
                            </div>
                            <div class="content">
                                <div class="home2_1">
                                    <div nctype="item_image" class="item"><img nctype="image"
                                                                               src="http://test.121mai.com/data/upload/shop/common/05152581740573275_240.gif"
                                                                               alt="">
                                    </div>
                                </div>
                                <div class="home2_2">
                                    <div class="home2_2_1">
                                        <div nctype="item_image" class="item"><img nctype="image"
                                                                                   src="http://test.121mai.com/data/upload/shop/common/05152581740573275_240.gif"
                                                                                   alt="">
                                        </div>
                                    </div>
                                    <div class="home2_2_2">
                                        <div nctype="item_image" class="item"><img nctype="image"
                                                                                   src="http://test.121mai.com/data/upload/shop/common/05152581740573275_240.gif"
                                                                                   alt="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="handle"><a nctype="btn_move_up" href="javascript:;"><i class="icon-arrow-up"></i>上移</a>
                        <a nctype="btn_move_down" href="javascript:;"><i class="icon-arrow-down"></i>下移</a> <a
                                nctype="btn_usable" data-item-id="2121" href="javascript:;"><i
                                    class="icon-off"></i>禁用</a> <a nctype="btn_edit_item" data-item-id="2121"
                                                                   href="javascript:;"><i class="icon-edit"></i>编辑</a>
                        <a nctype="btn_del_item" data-item-id="2121" href="javascript:;"><i
                                    class="icon-trash"></i>删除</a></div>
                    </td>
                </div>
                <div nctype="special_item" class="special-item mini_coupon_entrance unusable" data-item-id="2132">
                    <div class="item_type">小程序优惠券入口左右布局</div>
                    <div id="item_edit_content">
                        <div class="index_block home3">
                            <div class="title">
                                <span></span>
                            </div>
                            <div nctype="item_content" class="content" id="sortable_home3">
                                <div nctype="item_image" class="item"><img nctype="image"
                                                                           src="http://test.121mai.com/data/upload/shop/common/05152581740573275_240.gif"
                                                                           alt="">
                                </div>
                                <div nctype="item_image" class="item"><img nctype="image"
                                                                           src="http://test.121mai.com/data/upload/shop/common/05152581740573275_240.gif"
                                                                           alt="">
                                </div>
                            </div>
                        </div>

                        <script type="text/javascript">
                            $(function () {
                            })
                        </script>
                    </div>
                    <div class="handle"><a nctype="btn_move_up" href="javascript:;"><i class="icon-arrow-up"></i>上移</a>
                        <a nctype="btn_move_down" href="javascript:;"><i class="icon-arrow-down"></i>下移</a> <a
                                nctype="btn_usable" data-item-id="2132" href="javascript:;"><i
                                    class="icon-off"></i>启用</a> <a nctype="btn_edit_item" data-item-id="2132"
                                                                   href="javascript:;"><i class="icon-edit"></i>编辑</a>
                        <a nctype="btn_del_item" data-item-id="2132" href="javascript:;"><i
                                    class="icon-trash"></i>删除</a></div>
                    </td>
                </div>
                <div nctype="special_item" class="special-item goods usable" data-item-id="2120">
                    <div class="item_type">商品版块</div>
                    <div id="item_edit_content">
                        <!--v3-v12-->
                        <style type="text/css">
                            .mb-item-edit-content {
                                background: #EFFAFE url(http://test.121mai.com/admin/templates/default/images/cms_edit_bg_line.png) repeat-y scroll 0 0;
                            }
                        </style>
                        <div class="index_block goods-list">
                            <div class="title">
                                <span></span>
                            </div>
                            <div nctype="item_content" class="content" id="sortable">
                                <div nctype="item_image" class="item">
                                    <div class="goods-pic">
                                        <img nctype="goods_image"
                                             src="http://pic.121mai.com/57350_05790922295801864.jpg_240" alt="">
                                    </div>
                                    <div class="goods-name" nctype="goods_name">【夏天不难过，清凉来“席”】新款双色提花印花冰丝凉席三件套 爱心苹果金
                                        0.8*1.95
                                    </div>
                                    <div class="goods-price" nctype="goods_price">
                                        ￥36.00
                                    </div>
                                </div>
                                <div nctype="item_image" class="item">
                                    <div class="goods-pic">
                                        <img nctype="goods_image"
                                             src="http://pic.121mai.com/57350_05780674525675748.jpg_240" alt="">
                                    </div>
                                    <div class="goods-name" nctype="goods_name">【润盈敏+500亿活菌】儿童成人活性益生菌粉含益生元 5条装</div>
                                    <div class="goods-price" nctype="goods_price">
                                        ￥24.80
                                    </div>
                                </div>
                                <div nctype="item_image" class="item">
                                    <div class="goods-pic">
                                        <img nctype="goods_image"
                                             src="http://pic.121mai.com/57350_05780565339596674.jpg_240" alt="">
                                    </div>
                                    <div class="goods-name" nctype="goods_name">【润盈智+200亿活性益生菌】儿童活性益生菌粉含DHA 36条装</div>
                                    <div class="goods-price" nctype="goods_price">
                                        ￥166.00
                                    </div>
                                </div>

                            
                        
                            </div>
                        </div>
                        <script id="item_goods_template" type="text/html">
                            <div nctype="item_image" class="item">
                                <div class="goods-pic"><img nctype="image" src="<%=goods_image%>" alt=""></div>
                                <div class="goods-name" nctype="goods_name"><%=goods_name%></div>
                                <div class="goods-price" nctype="goods_price"><%=goods_price%></div>
                                <input nctype="goods_id" name="item_data[item][]" type="hidden" value="<%=goods_id%>">
                                <a nctype="btn_del_item_image" href="javascript:;"><i class="icon-trash"></i>删除</a>
                            </div>
                        </script>
                        <script src="http://test.121mai.com/data/resource/js/jquery.ajaxContent.pack.js"
                                type="text/javascript"></script>
                        <script type="text/javascript"
                                src="http://test.121mai.com/data/resource/js/jquery-ui/jquery.ui.js"></script>
                        <script type="text/javascript">
                            $(document).ready(function () {
                                $('#btn_mb_special_goods_search').on('click', function () {
                                    var url = 'http://test.121mai.com/admin/index.php?act=mb_special&op=goods_list';
                                    var search_type = $(".search-goods h5 select").val();
                                    var keyword = $('#txt_goods_name').val();
                                    if (keyword) {
                                        $('#mb_special_goods_list').load(url + '&' + $.param({
                                                    keyword: keyword,
                                                    search_type: search_type
                                                }));//v3-b12
                                    }
                                });

                                $('#mb_special_goods_list').on('click', '[nctype="btn_add_goods"]', function () {
                                    var item = {};
                                    item.goods_id = $(this).attr('data-goods-id');
                                    item.goods_name = $(this).attr('data-goods-name');
                                    item.goods_price = $(this).attr('data-goods-price');
                                    item.goods_image = $(this).attr('data-goods-image');
                                    var html = template.render('item_goods_template', item);
                                    $('[nctype="item_content"]').append(html);
                                });
                                $(".search-goods h5 select").change(function () {
                                    if ($(this).val() == 'goods_name') {
                                        $(this).next('i').html("模糊搜索");
                                    } else if ($(this).val() == 'goods_commonid') {
                                        $(this).next('i').html("精确搜索");
                                    } else if ($(this).val() == 'goods_id') {
                                        $(this).next('i').html("精确搜索");
                                    }
                                })
                            });
                        </script>
                    </div>
                    <div class="handle"><a nctype="btn_move_up" href="javascript:;"><i class="icon-arrow-up"></i>上移</a>
                        <a nctype="btn_move_down" href="javascript:;"><i class="icon-arrow-down"></i>下移</a> <a
                                nctype="btn_usable" data-item-id="2120" href="javascript:;"><i
                                    class="icon-off"></i>禁用</a> <a nctype="btn_edit_item" data-item-id="2120"
                                                                   href="javascript:;"><i class="icon-edit"></i>编辑</a>
                        <a nctype="btn_del_item" data-item-id="2120" href="javascript:;"><i
                                    class="icon-trash"></i>删除</a></div>
                    </td>
                </div>
                <div nctype="special_item" class="special-item home2 unusable" data-item-id="2133">
                    <div class="item_type">模型版块布局B</div>
                    <div id="item_edit_content">
                        <div class="index_block home2">
                            <div class="title">
                                <span></span>
                            </div>
                            <div class="content">
                                <div class="home2_1">
                                    <div nctype="item_image" class="item"><img nctype="image"
                                                                               src="http://test.121mai.com/data/upload/shop/common/05152581740573275_240.gif"
                                                                               alt="">
                                    </div>
                                </div>
                                <div class="home2_2">
                                    <div class="home2_2_1">
                                        <div nctype="item_image" class="item"><img nctype="image"
                                                                                   src="http://test.121mai.com/data/upload/shop/common/05152581740573275_240.gif"
                                                                                   alt="">
                                        </div>
                                    </div>
                                    <div class="home2_2_2">
                                        <div nctype="item_image" class="item"><img nctype="image"
                                                                                   src="http://test.121mai.com/data/upload/shop/common/05152581740573275_240.gif"
                                                                                   alt="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="handle"><a nctype="btn_move_up" href="javascript:;"><i class="icon-arrow-up"></i>上移</a>
                        <a nctype="btn_move_down" href="javascript:;"><i class="icon-arrow-down"></i>下移</a> <a
                                nctype="btn_usable" data-item-id="2133" href="javascript:;"><i
                                    class="icon-off"></i>启用</a> <a nctype="btn_edit_item" data-item-id="2133"
                                                                   href="javascript:;"><i class="icon-edit"></i>编辑</a>
                        <a nctype="btn_del_item" data-item-id="2133" href="javascript:;"><i
                                    class="icon-trash"></i>删除</a></div>
                    </td>
                </div>
            </div>
        </div>
        <div class="module-list">
            <div class="module_adv_list"><span>轮播图</span> <a nctype="btn_add_item" class="add" href="javascript:;"
                                                             data-module-type="adv_list">添加</a></div>
            <div class="module_home1"><span>模型版块布局A（单张图）</span> <a nctype="btn_add_item" class="add" href="javascript:;"
                                                                   data-module-type="home1">添加</a></div>
            <div class="module_home2"><span>模型版块布局B</span> <a nctype="btn_add_item" class="add" href="javascript:;"
                                                              data-module-type="home2">添加</a></div>
            <div class="module_home3"><span>模型版块布局C（五张图）</span> <a nctype="btn_add_item" class="add" href="javascript:;"
                                                                   data-module-type="home3">添加</a></div>
            <div class="module_mini_coupon_entrance"><span>小程序优惠券入口左右布局</span> <a nctype="btn_add_item" class="add"
                                                                                  href="javascript:;"
                                                                                  data-module-type="mini_coupon_entrance">添加</a>
            </div>
            <div class="module_goods"><span>商品版块</span> <a nctype="btn_add_item" class="add" href="javascript:;"
                                                           data-module-type="goods">添加</a></div>
        </div>
    </div>
</div>
<script type="text/javascript" src="http://test.121mai.com/data/resource/js/jquery-ui/jquery.ui.js"></script>
<script type="text/javascript" src="http://test.121mai.com/data/resource/js/dialog/dialog.js" id="dialog_js"
        charset="utf-8"></script>
<script type="text/javascript" src="http://test.121mai.com/data/resource/js/template.min.js" charset="utf-8"></script>
<!-- 页面模块模板 -->
<script id="item_template" type="text/html">
</script>
<script type="text/javascript">
    var special_id = 0;
    var url_item_add = "http://test.121mai.com/admin/index.php?act=mb_special&op=special_item_add";
    var url_item_del = "http://test.121mai.com/admin/index.php?act=mb_special&op=special_item_del";
    var url_item_edit = "http://test.121mai.com/admin/index.php?act=mb_special&op=special_item_edit";
    $(document).ready(function () {
        //添加模块
        $('[nctype="btn_add_item"]').on('click', function () {
            var data = {
                special_id: special_id,
                item_type: $(this).attr('data-module-type')
            };
            $.post(url_item_add, data, function (data) {
                if (typeof data.error === 'undefined') {
                    location.reload();
                } else {
                    showError(data.error);
                }
            }, "json");
        });

        //删除模块
        $('#item_list').on('click', '[nctype="btn_del_item"]', function () {
            if (!confirm('确认删除？')) {
                return false;
            }
            var $this = $(this);
            var item_id = $this.attr('data-item-id');
            $.post(url_item_del, {item_id: item_id, special_id: special_id}, function (data) {
                if (typeof data.error === 'undefined') {
                    $this.parents('.special-item').remove();
                } else {
                    showError(data.error);
                }
            }, "json");
        });

        //编辑模块
        $('#item_list').on('click', '[nctype="btn_edit_item"]', function () {
            var item_id = $(this).attr('data-item-id');
            go(url_item_edit + '&item_id=' + item_id);
        });

        //上移
        $('#item_list').on('click', '[nctype="btn_move_up"]', function () {
            var $current = $(this).parents('[nctype="special_item"]');
            $prev = $current.prev('[nctype="special_item"]');
            if ($prev.length > 0) {
                $prev.before($current);
                update_item_sort();
            } else {
                showError('已经是第一个了');
            }
        });

        //下移
        $('#item_list').on('click', '[nctype="btn_move_down"]', function () {
            var $current = $(this).parents('[nctype="special_item"]');
            $next = $current.next('[nctype="special_item"]');
            if ($next.length > 0) {
                $next.after($current);
                update_item_sort();
            } else {
                showError('已经是最后一个了');
            }
        });

        var update_item_sort = function () {
            var item_id_string = '';
            $item_list = $('#item_list').find('[nctype="special_item"]');
            $item_list.each(function (index, item) {
                item_id_string += $(item).attr('data-item-id') + ',';
            });
            $.post("index.php?act=mb_special&op=update_item_sort", {
                special_id: special_id,
                item_id_string: item_id_string
            }, function (data) {
                if (typeof data.error != 'undefined') {
                    showError(data.message);
                }
            }, 'json');
        };

        //启用/禁用控制
        $('#item_list').on('click', '[nctype="btn_usable"]', function () {
            var $current = $(this).parents('[nctype="special_item"]');
            var item_id = $current.attr('data-item-id');
            var usable = '';
            if ($current.hasClass('usable')) {
                $current.removeClass('usable');
                $current.addClass('unusable');
                usable = 'unusable';
                $(this).html('<i class="icon-off"></i>启用');
            } else {
                $current.removeClass('unusable');
                $current.addClass('usable');
                usable = 'usable';
                $(this).html('<i class="icon-off"></i>禁用');
            }

            $.post("index.php?act=mb_special&op=update_item_usable", {
                item_id: item_id,
                usable: usable,
                special_id: special_id
            }, function (data) {
                if (typeof data.error != 'undefined') {
                    showError(data.message);
                }
            }, 'json');
        });

    });
</script>
</body>
</html>
